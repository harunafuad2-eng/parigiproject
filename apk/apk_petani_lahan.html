<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luas Lahan - Gerbang Pangan</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="logogpid.png" type="image/png">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-white shadow-sm p-4 flex items-center sticky top-0 z-10">
        <a href="apk_dashboard_petani.html" class="p-2 rounded-full hover:bg-gray-100">
            <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
        </a>
        <h1 class="text-lg font-bold text-gray-800 mx-auto">Data Lahan Saya</h1>
        <div class="w-10"></div> <!-- Spacer -->
    </header>

    <main class="p-4">
        <div class="bg-white p-6 rounded-lg shadow max-w-2xl mx-auto">
            <form id="land-area-form" class="space-y-5">
                <div>
                    <label for="land-location" class="block text-sm font-medium text-gray-700 mb-1">Lokasi Lahan</label>
                    <input type="text" id="land-location" placeholder="Contoh: Desa Sukamaju, Blok A" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="land-area" class="block text-sm font-medium text-gray-700 mb-1">Luas</label>
                        <input type="number" id="land-area" step="0.1" placeholder="Contoh: 2.5" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="land-unit" class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
                        <select id="land-unit" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white">
                            <option>Hektar</option>
                            <option>Meter Persegi</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label for="land-commodity" class="block text-sm font-medium text-gray-700 mb-1">Komoditas Utama</label>
                    <input type="text" id="land-commodity" placeholder="Contoh: Padi, Jagung, Cabai" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                </div>

                <div>
                    <label for="land-status" class="block text-sm font-medium text-gray-700 mb-1">Status Lahan</label>
                    <select id="land-status" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white">
                        <option>Aktif Ditanami</option>
                        <option>Masa Panen</option>
                        <option>Tidak Aktif</option>
                    </select>
                </div>

                <div class="pt-4">
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">Simpan Perubahan</button>
                </div>
            </form>
        </div>
    </main>
    
    <!-- Alert/Toast Container -->
    <div id="alert-container" class="fixed top-5 right-5 z-50 space-y-2"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();

            const DB_LAND_AREAS_KEY = 'gerbangPanganLandAreas';
            const CUSTOMERS_KEY = 'gerbangPanganCustomers';
            const loggedInUserEmail = localStorage.getItem('loggedInUserEmail');

            if (!loggedInUserEmail) {
                window.location.replace('apk_login.html');
                return;
            }

            const form = document.getElementById('land-area-form');

            const getCurrentUser = () => {
                const customers = JSON.parse(localStorage.getItem(CUSTOMERS_KEY)) || [];
                return customers.find(c => c.email === loggedInUserEmail);
            };

            const loadLandData = () => {
                const currentUser = getCurrentUser();
                if (!currentUser) return;

                const allLandAreas = JSON.parse(localStorage.getItem(DB_LAND_AREAS_KEY)) || [];
                const userLandArea = allLandAreas.find(la => la.farmerName === currentUser.name);

                if (userLandArea) {
                    document.getElementById('land-location').value = userLandArea.landLocation;
                    document.getElementById('land-area').value = userLandArea.area;
                    document.getElementById('land-unit').value = userLandArea.unit;
                    document.getElementById('land-commodity').value = userLandArea.commodity;
                    document.getElementById('land-status').value = userLandArea.status;
                }
            };

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const currentUser = getCurrentUser();
                if (!currentUser) return;

                let allLandAreas = JSON.parse(localStorage.getItem(DB_LAND_AREAS_KEY)) || [];
                const userLandAreaIndex = allLandAreas.findIndex(la => la.farmerName === currentUser.name);

                const newData = {
                    id: userLandAreaIndex > -1 ? allLandAreas[userLandAreaIndex].id : 'la-' + Date.now(),
                    farmerName: currentUser.name,
                    landLocation: document.getElementById('land-location').value,
                    area: parseFloat(document.getElementById('land-area').value),
                    unit: document.getElementById('land-unit').value,
                    commodity: document.getElementById('land-commodity').value,
                    status: document.getElementById('land-status').value
                };

                if (userLandAreaIndex > -1) {
                    allLandAreas[userLandAreaIndex] = newData;
                } else {
                    allLandAreas.push(newData);
                }

                localStorage.setItem(DB_LAND_AREAS_KEY, JSON.stringify(allLandAreas));
                showAlert('Data lahan berhasil disimpan!', 'success');
            });

            function showAlert(message, type = 'success') {
                const alertContainer = document.getElementById('alert-container');
                const alertId = 'alert-' + Date.now();
                const bgColor = type === 'error' ? 'bg-red-500' : 'bg-green-500';

                const alertEl = document.createElement('div');
                alertEl.id = alertId;
                alertEl.className = `flex items-center p-4 text-white ${bgColor} rounded-lg shadow-lg transition-all duration-300 transform translate-x-full`;
                alertEl.innerHTML = `<div class="ml-3 text-sm font-medium">${message}</div>`;
                alertContainer.appendChild(alertEl);

                requestAnimationFrame(() => alertEl.classList.remove('translate-x-full'));
                setTimeout(() => alertEl.remove(), 3000);
            }

            // Load initial data
            loadLandData();
        });
    </script>

</body>
</html>