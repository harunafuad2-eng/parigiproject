<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard BUMDes - Manajemen Operasional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .nav-link.active {
            background-color: #3B82F6; /* blue-500 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-white text-gray-800 flex-shrink-0 border-r">
            <div class="p-6 border-b flex flex-col items-center text-center">
                <img src="assets/logogpid.png" alt="Logo Gerbang Pangan" class="h-20 w-20 object-contain mb-3">
                <p class="text-lg font-bold">BUMDes Maju Bersama</p>
                <p class="text-xs text-gray-500">Desa Sukamaju</p>
            </div>
            <nav id="sidebar-nav" class="p-4">
                <a href="#dashboard" class="nav-link flex items-center py-2 px-4 rounded-lg transition duration-200">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span>Dashboard</span>
                </a>
                <a href="#bahan-baku" class="nav-link flex items-center py-2 px-4 rounded-lg transition duration-200 mt-2">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    <span>Bahan Baku</span>
                </a>
                <a href="#produksi" class="nav-link flex items-center py-2 px-4 rounded-lg transition duration-200 mt-2">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm0 0c-1.657 0-3 1.343-3 3v6h6v-6c0-1.657-1.343-3-3-3z"></path></svg>
                    <span>Produksi</span>
                </a>
                <a href="#produk-jadi" class="nav-link flex items-center py-2 px-4 rounded-lg transition duration-200 mt-2">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                    <span>Produk Jadi</span>
                </a>
                 <a href="#distribusi" class="nav-link flex items-center py-2 px-4 rounded-lg transition duration-200 mt-2">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    <span>Distribusi</span>
                </a>
            </nav>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white shadow-sm p-4 flex justify-between items-center border-b">
                <h1 id="header-title" class="text-2xl font-semibold text-gray-800">Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-600">Selamat Datang, Ahmad Yani</span>
                    <img class="h-10 w-10 rounded-full object-cover" src="https://i.pravatar.cc/150?u=ahmad" alt="User Avatar">
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                <!-- Dashboard Content -->
                <div id="dashboard-content" class="page-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-500">Stok Bahan Baku</h3><p class="text-3xl font-bold text-gray-800 mt-2">4.2 Ton</p></div>
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-500">Stok Produk Jadi</h3><p class="text-3xl font-bold text-gray-800 mt-2">1,250 Unit</p></div>
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-500">Penjualan Bulan Ini</h3><p class="text-3xl font-bold text-gray-800 mt-2">Rp 50 Jt</p></div>
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-sm font-medium text-gray-500">Laba Bulan Ini</h3><p class="text-3xl font-bold text-green-600 mt-2">Rp 12.5 Jt</p></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Grafik Penjualan vs Pembelian (6 Bulan Terakhir)</h3>
                        <div class="h-80"><canvas id="bumdesDashboardChart"></canvas></div>
                    </div>
                </div>

                <!-- Bahan Baku Content -->
                <div id="bahan-baku-content" class="page-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-800">Manajemen Bahan Baku</h3>
                            <button id="add-bahan-baku-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Tambah Pembelian</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left"><thead class="bg-gray-50"><tr><th class="p-3">Tanggal</th><th class="p-3">Nama Bahan</th><th class="p-3">Sumber</th><th class="p-3">Jumlah</th><th class="p-3">Total Biaya</th></tr></thead>
                                <tbody id="bahan-baku-table-body" class="divide-y divide-gray-200">
                                    <tr><td class="p-3">02/10/2025</td><td class="p-3">Ikan Tuna</td><td class="p-3">Nelayan Lokal</td><td class="p-3">500 Kg</td><td class="p-3">Rp 15.000.000</td></tr>
                                    <tr><td class="p-3">01/10/2025</td><td class="p-3">Biji Kopi</td><td class="p-3">Petani Kopi</td><td class="p-3">1000 Kg</td><td class="p-3">Rp 25.000.000</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Produksi Content -->
                <div id="produksi-content" class="page-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                             <h3 class="text-xl font-semibold text-gray-800">Manajemen Produksi</h3>
                             <button id="add-produksi-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Catat Produksi Baru</button>
                        </div>
                        <div class="overflow-x-auto">
                           <table class="w-full text-left"><thead class="bg-gray-50"><tr><th class="p-3">Tanggal</th><th class="p-3">Bahan Baku Digunakan</th><th class="p-3">Jumlah</th><th class="p-3">Produk Jadi</th><th class="p-3">Jumlah Hasil</th></tr></thead>
                               <tbody id="produksi-table-body" class="divide-y divide-gray-200">
                                   <tr><td class="p-3">02/10/2025</td><td class="p-3">Ikan Tuna</td><td class="p-3">500 Kg</td><td class="p-3">Ikan Tuna Kaleng</td><td class="p-3">1500 Kaleng</td></tr>
                                   <tr><td class="p-3">01/10/2025</td><td class="p-3">Biji Kopi</td><td class="p-3">1000 Kg</td><td class="p-3">Kopi Bubuk Premium</td><td class="p-3">850 Kg</td></tr>
                               </tbody>
                           </table>
                        </div>
                    </div>
                </div>
                
                <!-- Produk Jadi Content -->
                <div id="produk-jadi-content" class="page-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                         <h3 class="text-xl font-semibold text-gray-800 mb-4">Stok Produk Jadi</h3>
                         <div class="overflow-x-auto">
                            <table class="w-full text-left"><thead class="bg-gray-50"><tr><th class="p-3">Nama Produk</th><th class="p-3">Stok Saat Ini</th><th class="p-3">Harga Jual / Satuan</th></tr></thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr><td class="p-3">Kopi Bubuk Premium</td><td class="p-3">500 Kg</td><td class="p-3">Rp 80.000</td></tr>
                                    <tr><td class="p-3">Keripik Pisang</td><td class="p-3">1000 Pcs</td><td class="p-3">Rp 10.000</td></tr>
                                    <tr><td class="p-3">Ikan Tuna Kaleng</td><td class="p-3">2500 Kaleng</td><td class="p-3">Rp 20.000</td></tr>
                                </tbody>
                            </table>
                         </div>
                    </div>
                </div>

                <!-- Distribusi Content -->
                <div id="distribusi-content" class="page-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                         <div class="flex justify-between items-center mb-4">
                             <h3 class="text-xl font-semibold text-gray-800">Distribusi ke Koperasi</h3>
                             <button id="add-distribusi-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Tambah Distribusi</button>
                        </div>
                         <div class="overflow-x-auto">
                           <table class="w-full text-left"><thead class="bg-gray-50"><tr><th class="p-3">Tanggal</th><th class="p-3">Koperasi Tujuan</th><th class="p-3">Produk</th><th class="p-3">Jumlah</th><th class="p-3">Total Penjualan</th></tr></thead>
                               <tbody id="distribusi-table-body" class="divide-y divide-gray-200">
                                   <tr><td class="p-3">03/10/2025</td><td class="p-3">Koperasi Tani Makmur</td><td class="p-3">Kopi Bubuk Premium</td><td class="p-3">500 Kg</td><td class="p-3">Rp 40.000.000</td></tr>
                                   <tr><td class="p-3">01/10/2025</td><td class="p-3">Koperasi Jaya Bersama</td><td class="p-3">Keripik Pisang</td><td class="p-3">1000 Pcs</td><td class="p-3">Rp 10.000.000</td></tr>
                               </tbody>
                           </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="add-bahan-baku-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Tambah Pembelian Bahan Baku</h3>
            <form id="add-bahan-baku-form">
                <div class="space-y-4">
                    <div><label for="bb-tanggal" class="block text-sm">Tanggal</label><input type="date" id="bb-tanggal" required class="w-full p-2 border rounded"></div>
                    <div><label for="bb-nama" class="block text-sm">Nama Bahan</label><input type="text" id="bb-nama" required class="w-full p-2 border rounded"></div>
                    <div><label for="bb-sumber" class="block text-sm">Sumber</label><input type="text" id="bb-sumber" placeholder="Cth: Petani Lokal" required class="w-full p-2 border rounded"></div>
                    <div><label for="bb-jumlah" class="block text-sm">Jumlah (Kg/Unit)</label><input type="number" id="bb-jumlah" required class="w-full p-2 border rounded"></div>
                    <div><label for="bb-biaya" class="block text-sm">Total Biaya</label><input type="number" id="bb-biaya" required class="w-full p-2 border rounded"></div>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-bahan-baku-btn" class="px-4 py-2 bg-gray-200 rounded-md">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Simpan</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-produksi-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Catat Produksi Baru</h3>
            <form id="add-produksi-form">
                 <div class="space-y-4">
                    <div><label for="p-tanggal" class="block text-sm">Tanggal</label><input type="date" id="p-tanggal" required class="w-full p-2 border rounded"></div>
                    <div><label for="p-bahan" class="block text-sm">Bahan Baku Digunakan</label><input type="text" id="p-bahan" required class="w-full p-2 border rounded"></div>
                    <div><label for="p-jumlah-bahan" class="block text-sm">Jumlah Digunakan</label><input type="text" id="p-jumlah-bahan" placeholder="Cth: 500 Kg" required class="w-full p-2 border rounded"></div>
                    <div><label for="p-produk" class="block text-sm">Produk Jadi</label><input type="text" id="p-produk" required class="w-full p-2 border rounded"></div>
                    <div><label for="p-jumlah-hasil" class="block text-sm">Jumlah Hasil</label><input type="text" id="p-jumlah-hasil" placeholder="Cth: 1500 Kaleng" required class="w-full p-2 border rounded"></div>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-produksi-btn" class="px-4 py-2 bg-gray-200 rounded-md">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Simpan</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-distribusi-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Tambah Distribusi</h3>
            <form id="add-distribusi-form">
                <div class="space-y-4">
                    <div><label for="d-tanggal" class="block text-sm">Tanggal</label><input type="date" id="d-tanggal" required class="w-full p-2 border rounded"></div>
                    <div><label for="d-koperasi" class="block text-sm">Koperasi Tujuan</label><input type="text" id="d-koperasi" required class="w-full p-2 border rounded"></div>
                    <div><label for="d-produk" class="block text-sm">Produk</label><input type="text" id="d-produk" required class="w-full p-2 border rounded"></div>
                    <div><label for="d-jumlah" class="block text-sm">Jumlah</label><input type="text" id="d-jumlah" placeholder="Cth: 500 Kg" required class="w-full p-2 border rounded"></div>
                    <div><label for="d-total" class="block text-sm">Total Penjualan</label><input type="number" id="d-total" required class="w-full p-2 border rounded"></div>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-distribusi-btn" class="px-4 py-2 bg-gray-200 rounded-md">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Simpan</button>
                </div>
            </form>
        </div>
    </div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const DB_PURCHASES_KEY = 'gerbangPanganPurchases';
        const BUMDES_NAME = 'BUMDes Maju Bersama'; // Nama BUMDes saat ini
        let bumdesDashboardChartInstance = null;
        const pages = document.querySelectorAll('.page-content');
        const navLinks = document.querySelectorAll('.nav-link');
        const headerTitle = document.getElementById('header-title');

        const getFromDB = (key) => JSON.parse(localStorage.getItem(key)) || [];
        const saveToDB = (key, data) => localStorage.setItem(key, JSON.stringify(data));
        const formatRupiah = (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);

        // --- Navigation Logic ---
        function showPage(pageId) {
            pages.forEach(p => p.classList.add('hidden'));
            navLinks.forEach(l => l.classList.remove('active'));
            
            const targetPage = document.getElementById(pageId + '-content');
            if (targetPage) targetPage.classList.remove('hidden');
            
            const activeLink = document.querySelector(`.nav-link[href="#${pageId}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
                headerTitle.textContent = activeLink.querySelector('span').textContent;
            }

            // Render content based on page
            if (pageId === 'dashboard') renderDashboard();
            if (pageId === 'bahan-baku') renderBahanBakuTable();
        }

        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const pageId = link.getAttribute('href').substring(1);
                window.location.hash = pageId;
            });
        });

        window.addEventListener('hashchange', () => {
            const pageId = window.location.hash.substring(1) || 'dashboard';
            showPage(pageId);
        });
        
        // --- Modal Handling ---
        function setupModal(modalId, openBtnId, cancelBtnId, formId, onSubmit) {
            const modal = document.getElementById(modalId), openBtn = document.getElementById(openBtnId), cancelBtn = document.getElementById(cancelBtnId), form = document.getElementById(formId);
            if(!modal || !openBtn || !cancelBtn || !form) return;
            
            openBtn.addEventListener('click', () => modal.classList.remove('hidden'));
            cancelBtn.addEventListener('click', () => modal.classList.add('hidden'));
            
            form.addEventListener('submit', e => {
                e.preventDefault();
                onSubmit(form);
                form.reset();
                modal.classList.add('hidden');
            });
        }

        // --- Data Logic ---
        function renderDashboard() {
            const purchases = getFromDB(DB_PURCHASES_KEY);
            const bumdesPurchases = purchases.filter(p => p.supplier === BUMDES_NAME); // BUMDes menjual
            const bumdesBuys = purchases.filter(p => p.koperasiAsal === BUMDES_NAME); // BUMDes membeli

            const totalPenjualan = bumdesPurchases.reduce((sum, p) => sum + p.total, 0);
            const laba = totalPenjualan - bumdesBuys.reduce((sum, p) => sum + p.total, 0);

            document.querySelector('#dashboard-content .text-3xl').textContent = formatRupiah(totalPenjualan);
            document.querySelector('#dashboard-content .text-green-600').textContent = formatRupiah(laba);

            renderBumdesDashboardChart(bumdesBuys, bumdesPurchases);
        }

        function renderBahanBakuTable() {
            const purchases = getFromDB(DB_PURCHASES_KEY);
            const bumdesBuys = purchases.filter(p => p.koperasiAsal === BUMDES_NAME);
            const tableBody = document.getElementById('bahan-baku-table-body');
            tableBody.innerHTML = '';
            if (bumdesBuys.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="p-4 text-center text-gray-500">Belum ada pembelian bahan baku.</td></tr>`;
                return;
            }
            bumdesBuys.forEach(p => {
                tableBody.innerHTML += `<tr><td class="p-3">${new Date(p.date).toLocaleDateString('id-ID')}</td><td class="p-3">${p.productName}</td><td class="p-3">${p.supplier}</td><td class="p-3">${p.quantity} ${p.unit}</td><td class="p-3">${formatRupiah(p.total)}</td></tr>`;
            });
        }

        // Setup Modals with localStorage saving
        setupModal('add-bahan-baku-modal', 'add-bahan-baku-btn', 'cancel-bahan-baku-btn', 'add-bahan-baku-form', form => {
            const purchases = getFromDB(DB_PURCHASES_KEY);
            const newPurchase = {
                id: 'PUR-' + Date.now(),
                date: form['bb-tanggal'].value,
                supplier: form['bb-sumber'].value,
                productName: form['bb-nama'].value,
                quantity: parseFloat(form['bb-jumlah'].value),
                unit: 'Kg', // Asumsi
                price: parseFloat(form['bb-biaya'].value) / parseFloat(form['bb-jumlah'].value),
                total: parseFloat(form['bb-biaya'].value),
                koperasiAsal: BUMDES_NAME // Menandakan BUMDes ini yang membeli
            };
            purchases.push(newPurchase);
            saveToDB(DB_PURCHASES_KEY, purchases);
            renderBahanBakuTable();
        });

        // --- Charting ---
        function renderBumdesDashboardChart(pembelian, penjualan) {
            if (bumdesDashboardChartInstance) bumdesDashboardChartInstance.destroy();
            const ctx = document.getElementById('bumdesDashboardChart')?.getContext('2d');
            if (!ctx) return;

            const labels = ['Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober'];
            const penjualanData = labels.map((_, i) => Math.random() * 50); // Simulasi
            const pembelianData = labels.map((_, i) => Math.random() * 40); // Simulasi

            bumdesDashboardChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Penjualan (Juta Rp)', data: penjualanData, backgroundColor: 'rgba(54, 162, 235, 0.6)' },
                        { label: 'Pembelian (Juta Rp)', data: pembelianData, backgroundColor: 'rgba(255, 99, 132, 0.6)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { callback: v => `Rp ${v} Jt` } } } }
            });
        }
        
        // Initial Load
        const initialPage = window.location.hash.substring(1) || 'dashboard';
        showPage(initialPage);
    });
</script>

</body>
</html>
